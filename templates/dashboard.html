<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Health Dashboard</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }
      
      h1, #email-config-form h2 {
        color: #333;
      }
      
      #dashboard {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      
      .service-card, #add-host-form, #email-config-form {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .service-card {
        width: calc(33.333% - 20px);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }
      
      .service-card h5, .service-card p {
        margin: 5px 0;
        font-size: 14px;
      }
      
      .service-card h5 {
        margin-top: 0;
        margin-bottom: 10px;
        word-break: break-all;
      }
      
      .form-container {
        display: flex;
        flex-wrap: wrap;
        margin-left: 20px;
      }
      
      #add-host-form, #email-config-form {
        width: 35%;
        max-width: 400px;
        margin: 20px 20px 20px 0;
        padding: 20px;
        background-color: #f8f8f8;
      }
      
      #new-service-input, #email-config-form input {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      
      #add-service-button, #save-email-config {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      
      #add-service-button:hover, #save-email-config:hover {
        background-color: #45a049;
      }
      
      .btn-danger {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }
      
      .btn-danger:hover {
        background-color: #c82333;
      }
      
      #email-config-form form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      
      #email-config-form div {
        display: flex;
        flex-direction: column;
      }
      
      #email-config-form label {
        font-weight: bold;
        margin-bottom: 5px;
        color: #555;
      }
      
      #email-config-form input:focus, #new-service-input:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
      }
      
      @media (max-width: 1200px) {
        .service-card {
          width: calc(50% - 20px);
        }
      }
      
      @media (max-width: 768px) {
        .service-card, #add-host-form, #email-config-form {
          width: 100%;
        }
      
        .form-container {
          flex-direction: column;
          margin-left: 0;
        }
      
        #add-host-form, #email-config-form {
          width: 90%;
          margin: 10px auto;
        }
      
        #email-config-form {
          order: 1;
        }
      
        #add-host-form {
          order: 2;
        }
      }
      
    </style>

  </head>
  <body>
    <h1>Service Health Dashboard</h1>

    <div class="form-container">
      <!-- New Email Configuration Form -->
      <div id="email-config-form">
        <h2>Email Configuration</h2>
        <form>
          <div>
            <label for="client-email">Your email:</label>
            <input
              type="email"
              id="client-email"
              name="client-email"
              required
            />
          </div>
          <div>
            <label for="receiver-email">Receiver email:</label>
            <input
              type="email"
              id="receiver-email"
              name="receiver-email"
              required
            />
          </div>
          <div>
            <label for="email-password">Password:</label>
            <input
              type="password"
              id="email-password"
              name="email-password"
              required
            />
          </div>
          <button type="submit" id="save-email-config">
            Save Email Configuration
          </button>
        </form>
      </div>

      <!-- New Host Form -->
      <div id="add-host-form">
        <h2>Add New Host</h2>
        <input
          type="text"
          id="new-service-input"
          placeholder="Enter host URL (e.g., http://example.com)"
        />
        <button id="add-service-button">Add Host</button>
      </div>
    </div>

    <div id="dashboard"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const addServiceButton = document.getElementById("add-service-button");
        const removeServiceButton = document.querySelectorAll(
          ".btn-remove-service"
        );
        const newServiceInput = document.getElementById("new-service-input");

        addServiceButton.addEventListener("click", function () {
          const newService = newServiceInput.value.trim();
          if (newService) {
            addNewService(newService);
            newServiceInput.value = ""; // Clear the input field
          }
        });

        removeServiceButton.forEach((button) => {
          button.addEventListener("click", function () {
            const serviceUrl = this.getAttribute("data-service-url");
            removeService(serviceUrl);
          });
        });

        function addNewService(service) {
          fetch("/add_service", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ url: service }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert(data.message);
                updateDashboard(); // Refresh the dashboard
              } else {
                alert(data.message);
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("An error occurred. Please try again.");
            });
        }

        function removeService(serviceUrl) {
          if (confirm("Are you sure you want to remove this service?")) {
            fetch("/remove_service", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ url: serviceUrl }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  updateDashboard(); // Refresh the dashboard
                  alert("Service removed successfully");
                } else {
                  alert("Failed to remove service: " + data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("An error occurred while removing the service");
              });
          }
        }

        function setQualityColor(quality, element) {
          switch (quality) {
            case "Terrible":
              element.style.color = "#FF0000"; // Red
              break;
            case "Very Bad":
              element.style.color = "#FF4500"; // OrangeRed
              break;
            case "Bad":
              element.style.color = "#FFA500"; // Orange
              break;
            case "Good":
              element.style.color = "#FFFF00"; // Yellow
              break;
            case "Very Good":
              element.style.color = "#9ACD32"; // YellowGreen
              break;
            case "Excellent":
              element.style.color = "#32CD32"; // LimeGreen
              break;
            case "Amazing":
              element.style.color = "#008000"; // Green
              break;
            default:
              element.style.color = "#000000"; // Black (default)
          }
        }

        function updateDashboard() {
          fetch("/data")
            .then((response) => response.json())
            .then((data) => {
              const dashboard = document.getElementById("dashboard");
              dashboard.innerHTML = "";
              data.forEach((service) => {
                const card = document.createElement("div");
                card.className = "service-card";
                card.innerHTML = `
                    <h5 title="${service.url}">${service.url}</h5>
                    <p>Status: ${service.status_code}</p>
                    <p>Response Time: ${service.response_time} seconds</p>
                    <p>Quality: <span class="quality-display">${service.quality}</span></p>
                    <button class="btn-danger btn-sm btn-remove-service" data-service-url="${service.url}">Remove Service</button>
                  `;
                dashboard.appendChild(card);

                // Set the color for the quality display
                const qualityElement = card.querySelector(".quality-display");
                setQualityColor(service.quality, qualityElement);

                // Add click event listener to the "Remove Service" button
                const removeServiceButton = card.querySelector(
                  ".btn-remove-service"
                );
                removeServiceButton.addEventListener("click", () => {
                  removeService(service.url);
                });
              });
            });
        }

        updateDashboard();
        setInterval(updateDashboard, 2000); // Update every 2 seconds
      });
    </script>
  </body>
</html>
